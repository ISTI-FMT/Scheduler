
#include "stdafx.h"
#include "stdafx.h"
using namespace Microsoft::VisualStudio::TestTools::UnitTesting;
namespace SchedulerATSTest {
	using namespace System;
	using namespace System::Threading;
	using namespace System::Threading::Tasks;
	using namespace System::Net::Sockets;
	using namespace System::Net;
	ref class ThreadListenerATC_IXLTest;


	/// <summary>
	///Classe di test per ThreadListenerATC_IXLTest.
	///Creata per contenere tutti gli unit test ThreadListenerATC_IXLTest
	///</summary>
	[TestClass]
	public ref class ThreadListenerATC_IXLTest
	{

	private: array<Byte>^fromString(String ^msg){
				 int len = ( msg->Length / 2)+(msg->Length%2);//+1;
				 array<Byte>^sendBytes = gcnew array<Byte>(len);
				 for (int i = 0; i < sendBytes->Length; i++)
				 {
					 String ^str = msg->Substring(i *2, 2);
					 int h =str->Length;
					 if(h>1){
						 sendBytes[i] = Byte::Parse(str,System::Globalization::NumberStyles::HexNumber);
					 }
				 }
				 return sendBytes;
			 };

			 Microsoft::VisualStudio::TestTools::UnitTesting::TestContext^  testContextInstance;
			 /// <summary>
			 ///Ottiene o imposta il contesto dei test, che fornisce
			 ///funzionalità e informazioni sull'esecuzione dei test corrente.
			 ///</summary>
	public: property Microsoft::VisualStudio::TestTools::UnitTesting::TestContext^  TestContext
			{
				Microsoft::VisualStudio::TestTools::UnitTesting::TestContext^  get()
				{
					return testContextInstance;
				}
				System::Void set(Microsoft::VisualStudio::TestTools::UnitTesting::TestContext^  value)
				{
					testContextInstance = value;
				}
			}

#pragma region Attributi di test aggiuntivi
			// 
			//Durante la scrittura dei test è possibile utilizzare i seguenti attributi aggiuntivi:
			//
			//Utilizzare ClassInitialize per eseguire il codice prima di eseguire il primo test della classe
			//public: [ClassInitialize]
			//static System::Void MyClassInitialize(TestContext^  testContext)
			//{
			//}
			//
			//Utilizzare ClassCleanup per eseguire il codice dopo l'esecuzione di tutti i test di una classe
			//public: [ClassCleanup]
			//static System::Void MyClassCleanup()
			//{
			//}
			//
			//Utilizzare TestInitialize per eseguire il codice prima di eseguire ciascun test
			//
			//public: [TestInitialize]
			//System::Void MyTestInitialize()
			//{
			//}
			//Utilizzare TestCleanup per eseguire il codice dopo l'esecuzione di ciascun test
			//public: [TestCleanup]
			//System::Void MyTestCleanup()
			//{
			//}
			//
#pragma endregion
			/// <summary>
			///Test per Costruttore ThreadListenerATC_IXL
			///</summary>
	public: [TestMethod]
			void ThreadListenerATC_IXLConstructorTest()
			{
				ManagerStatoLineaIXL^  MC = gcnew ManagerStatoLineaIXL();
				ManagerStatoLineaATC^  MA = gcnew ManagerStatoLineaATC();
				ThreadListenerATC_IXL^  target = (gcnew ThreadListenerATC_IXL(MC, MA));
				Thread^ oThreadUDP = gcnew Thread( gcnew ThreadStart( target, &ThreadListenerATC_IXL::UDP_Management_receive ) );

				oThreadUDP->Start();

				String ^msgIXL  ="0184BFFFFFFFE01465000001901008F0000019110000019210000019310000019410000019510000019610000019710000019810000019910000019A10000019B10000019C10000019D10000019E10000019F1000001A01000001A11000001A21000001A31000001A41000001A51000001A61000001A71000001A81000001A91000001AA1000001AB1000001AC1000001AD1000001B81000001B91000001BA1000001BB1000001BC1000001BD1000001BE1000001BF1000001C01000001C11000001F51000001F61000001F71000001F81000001F910000271A10000271B10000271C10000271D10000283D10000283E100002B02100002B03100002B04100002B05100002B0C100002B0D100002B0E100002B0F100002C25100002C26100002EEA100002EEB100002EEC100002EED100002EEE100002EEF100002EF0100002EF4100002EF5100002EF6100002EF7100002EF8100002EF9100002EFA10000300D10000300E10000300F1000032D21000032D31000032D41000033F51000033F61000036BA1000036BB1000036BC1000036C41000036C51000036C61000037DD1000037DE100003AA2100003AA3100003AA4100003AAC100003AAD100003AAE100003BC5100003BC6100003E8A100003E8B100003E8C100003E8D100003E8E100003E8F100003E90100003E91100003E94100003E9B100003E96100003E97100003E98100003E95100003E99100003E9A100003FAD100003FAE100003FAF10000427210000427310000427410000427510000427610000427710000427810000427910000427A10000427B10000427C10000428610000428710000428810000428910000428A10000428B10000428C10000428D10000428E10000428F1000042901000043951000043961000043971000043981044FC800013BA04010C00009DD4200004EEC2000027770800015AE080000AD742000056BC100002B5F0800015B0040000AD844000056C4100002B630800017A2080000BD14200005E8C100002F470800017A4040000BD24400005E94200002F4B0800017A6040000BD34200005E9C100002F4F1000017A8040000BD4420000665810000332D080001997080000CCBC200006E28200003715080001B8B040000DC5C200006E30100003719100001B8D040000DC6C2000075F8200003AFD080001D7F040000EBFC200007600100003B01100001D81040000EC0C200007DC8100003EE5080001F73080000FB9C200007DD0100003EE9080001F75040000FBAC400007DD8200003EED080001F77040000FBBC200007DE0100003EF11000021660400010B3440000859C1000042CF0800021680800010B442000085A41000042D30828A240000D49100110000390B40000E4310000296C40000F3CD00003CF440000B55500002D5640000C4F50000313E40000C4FD00003140400010379000040DF400010381000040E1400011319000044C74180";
				String ^msgIXL2  ="014B1FFFFFFFE01465000001901008F0000019110000019210000019310000019410000019510000019610000019710000019810000019910000019A10000019B10000019C10000019D10000019E10000019F1000001A01000001A11000001A21000001A31000001A41000001A51000001A61000001A71000001A81000001A91000001AA1000001AB1000001AC1000001AD1000001B81000001B91000001BA1000001BB1000001BC1000001BD1000001BE1000001BF1000001C01000001C11000001F51000001F61000001F71000001F81000001F910000271A10000271B10000271C10000271D10000283D10000283E100002B02100002B03100002B04100002B05100002B0C000002B0D000002B0E100002B0F100002C25000002C26100002EEA100002EEB100002EEC100002EED100002EEE100002EEF100002EF0100002EF4100002EF5100002EF6100002EF7100002EF8100002EF9100002EFA10000300D10000300E10000300F1000032D20000032D30000032D41000033F50000033F61000036BA1000036BB1000036BC1000036C41000036C51000036C61000037DD1000037DE100003AA2100003AA3100003AA4100003AAC000003AAD000003AAE100003BC5000003BC6100003E8A100003E8B100003E8C100003E8D100003E8E100003E8F100003E90100003E91100003E94100003E9B100003E96100003E97100003E98100003E95100003E99100003E9A100003FAD100003FAE100003FAF10000427210000427310000427410000427510000427610000427710000427810000427910000427A10000427B10000427C10000428610000428710000428810000428910000428A10000428B10000428C10000428D10000428E10000428F1000042901000043951000043961000043971000043981044FC800013BA04010C00009DD4200004EEC2000027770800015AE080000AD742000056BC100002B5F0800015B0040000AD844000056C4100002B630800017A2080000BD14200005E8C100002F470800017A4040000BD24400005E94200002F4B0800017A6040000BD34200005E9C100002F4F1000017A8040000BD4420000665810000332D080001997080000CCBC200006E28200003715080001B8B040000DC5C200006E30100003719100001B8D040000DC6C2000075F8200003AFD080001D7F040000EBFC200007600100003B01100001D81040000EC0C200007DC8100003EE5080001F73080000FB9C200007DD0100003EE9080001F75040000FBAC400007DD8200003EED080001F77040000FBBC200007DE0100003EF11000021660400010B3440000859C1000042CF0800021680800010B442000085A41000042D30828A240000D49100110000390B40000E4310000296C40000F3CD00003CF440000B55500002D5640000C4F50000313E40000C4FD00003140400010379000040DF400010381000040E1400011319000044C741906C00005462000E80000A91400001523000002A4700000549000000B8640000170D000002E23000005C4800000B8B4000017170000035E9000006BD400000D7F400001AFF0000035FF000006C0000000C8040000190100000320300000640800000C82C0000190600000320D00000642A00000C8580000190B8000039D10000073A400000E76C00001CEE0000039E50000073CC00000F6E400001EDD000003DC3000007B8800000F73400001EE70000041A100000834400001068C000020D20000041AB0000083580000106B4000020DA8000041B600000836E000011624000022C580000459D000008B3C00001167C000022D00000045A1000008B4400001168C000022D20FFFF";
				array<Byte> ^sendBytes = fromString(msgIXL);
				array<Byte> ^sendBytes2 = fromString(msgIXL2);
				Messaggi ^sds = gcnew Messaggi();
				sds->deserialize(sendBytes2);

				Socket ^s = gcnew Socket(System::Net::Sockets::AddressFamily::InterNetwork, System::Net::Sockets::SocketType::Dgram,
					System::Net::Sockets::ProtocolType::Udp);

				IPAddress ^broadcast = IPAddress::Parse("127.0.0.1");
				IPEndPoint ^ep = gcnew IPEndPoint(broadcast, 4010);

				s->SendTo( sendBytes, ep);
				s->SendTo( sendBytes2, ep);
				s->SendTo( sendBytes2, ep);
				
				s->Close();
				
				 Thread::Sleep(1000);
				 target->RequestStop();
				  Thread::Sleep(200);
			}
			/// <summary>
			///Test per Costruttore ThreadListenerATC_IXL
			///</summary>
	public: [TestMethod]
			void ThreadListenerATC_IXLConstructorTest2()
			{
				ManagerStatoLineaIXL^  MC = gcnew ManagerStatoLineaIXL();
				ManagerStatoLineaATC^  MA = gcnew ManagerStatoLineaATC();
				ThreadListenerATC_IXL^  target = (gcnew ThreadListenerATC_IXL(MC, MA));
				Thread^ oThreadUDP = gcnew Thread( gcnew ThreadStart( target, &ThreadListenerATC_IXL::UDP_Management_receive ) );

				oThreadUDP->Start();

				
				String ^msgATC  ="0B0A8000000411A265000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
				String ^msgATC2  ="0B022000000411A00B0000FF0000000480000033F600050001004F00000495000043970000000000000000000000000000FF24000004820000283D0000FF020000047F0000300F0001000F0000000000003FAD0000000000000000000000000000000000000000000000000000";
				array<Byte> ^sendBytes = fromString(msgATC);
				array<Byte> ^sendBytes2 = fromString(msgATC2);

				Socket ^s = gcnew Socket(System::Net::Sockets::AddressFamily::InterNetwork, System::Net::Sockets::SocketType::Dgram,
					System::Net::Sockets::ProtocolType::Udp);

				IPAddress ^broadcast = IPAddress::Parse("127.0.0.1");
				IPEndPoint ^ep = gcnew IPEndPoint(broadcast, 4010);

				s->SendTo( sendBytes2, ep);
				s->SendTo( sendBytes2, ep);
				s->SendTo( sendBytes2, ep);
				s->SendTo( sendBytes2, ep);
				s->SendTo( sendBytes, ep);


				s->Close();
				 Thread::Sleep(1000);
				 target->RequestStop();
				  Thread::Sleep(200);
			}
			/// <summary>
			///Test per ConfrontaArrayByte
			///</summary>
	public: [TestMethod]
			void ConfrontaArrayByteTest()
			{
				String ^msg  ="0184BFFFFFFFE01465000001901008F0000019110000019210000019310000019410000019510000019610000019710000019810000019910000019A10000019B10000019C10000019D10000019E10000019F1000001A01000001A11000001A21000001A31000001A41000001A51000001A61000001A71000001A81000001A91000001AA1000001AB1000001AC1000001AD1000001B81000001B91000001BA1000001BB1000001BC1000001BD1000001BE1000001BF1000001C01000001C11000001F51000001F61000001F71000001F81000001F910000271A10000271B10000271C10000271D10000283D10000283E100002B02100002B03100002B04100002B05100002B0C100002B0D100002B0E100002B0F100002C25100002C26100002EEA100002EEB100002EEC100002EED100002EEE100002EEF100002EF0100002EF4100002EF5100002EF6100002EF7100002EF8100002EF9100002EFA10000300D10000300E10000300F1000032D21000032D31000032D41000033F51000033F61000036BA1000036BB1000036BC1000036C41000036C51000036C61000037DD1000037DE100003AA2100003AA3100003AA4100003AAC100003AAD100003AAE100003BC5100003BC6100003E8A100003E8B100003E8C100003E8D100003E8E100003E8F100003E90100003E91100003E94100003E9B100003E96100003E97100003E98100003E95100003E99100003E9A100003FAD100003FAE100003FAF10000427210000427310000427410000427510000427610000427710000427810000427910000427A10000427B10000427C10000428610000428710000428810000428910000428A10000428B10000428C10000428D10000428E10000428F1000042901000043951000043961000043971000043981044FC800013BA04010C00009DD4200004EEC2000027770800015AE080000AD742000056BC100002B5F0800015B0040000AD844000056C4100002B630800017A2080000BD14200005E8C100002F470800017A4040000BD24400005E94200002F4B0800017A6040000BD34200005E9C100002F4F1000017A8040000BD4420000665810000332D080001997080000CCBC200006E28200003715080001B8B040000DC5C200006E30100003719100001B8D040000DC6C2000075F8200003AFD080001D7F040000EBFC200007600100003B01100001D81040000EC0C200007DC8100003EE5080001F73080000FB9C200007DD0100003EE9080001F75040000FBAC400007DD8200003EED080001F77040000FBBC200007DE0100003EF11000021660400010B3440000859C1000042CF0800021680800010B442000085A41000042D30828A240000D49100110000390B40000E4310000296C40000F3CD00003CF440000B55500002D5640000C4F50000313E40000C4FD00003140400010379000040DF400010381000040E1400011319000044C74180";
				array<Byte> ^ A= fromString(msg);
				array< Byte >^  B = fromString(msg);
				bool expected = true; 
				bool actual= ThreadListenerATC_IXL::ConfrontaArrayByte(A, B);
				Assert::AreEqual(expected, actual);

				msg  ="0184BFFFFFFFE01465000001901008F0000019110000019210000019310000019410000019510000019610000019710000019810000019910000019A10000019B10000019C10000019D10000019E10000019F1000001A01000001A11000001A21000001A31000001A41000001A51000001A61000001A71000001A81000001A91000001AA1000001AB1000001AC1000001AD1000001B81000001B91000001BA1000001BB1000001BC1000001BD1000001BE1000001BF1000001C01000001C11000001F51000001F61000001F71000001F81000001F910000271A10000271B10000271C10000271D10000283D10000283E100002B02100002B03100002B04100002B05100002B0C100002B0D100002B0E100002B0F100002C25100002C26100002EEA100002EEB100002EEC100002EED100002EEE100002EEF100002EF0100002EF4100002EF5100002EF6100002EF7100002EF8100002EF9100002EFA10000300D10000300E10000300F1000032D21000032D31000032D41000033F51000033F61000036BA1000036BB1000036BC1000036C41000036C51000036C61000037DD1000037DE100003AA2100003AA3100003AA4100003AAC100003AAD100003AAE100003BC5100003BC6100003E8A100003E8B100003E8C100003E8D100003E8E100003E8F100003E90100003E91100003E94100003E9B100003E96100003E97100003E98100003E95100003E99100003E9A100003FAD100003FAE100003FAF10000427210000427310000427410000427510000427610000427710000427810000427910000427A10000427B10000427C10000428610000428710000428810000428910000428A10000428B10000428C10000428D10000428E10000428F1000042901000043951000043961000043971000043981044FC800013BA04010C00009DD4200004EEC2000027770800015AE080000AD742000056BC100002B5F0800015B0040000AD844000056C4100002B630800017A2080000BD14200005E8C100002F470800017A4040000BD24400005E94200002F4B0800017A6040000BD34200005E9C100002F4F1000017A8040000BD4420000665810000332D080001997080000CCBC200006E28200003715080001B8B040000DC5C200006E30100003719100001B8D040000DC6C2000075F8200003AFD080001D7F040000EBFC200007600100003B01100001D81040000EC0C200007DC8100003EE5080001F73080000FB9C200007DD0100003EE9080001F75040000FBAC400007DD8200003EED080001F77040000FBBC200007DE0100003EF11000021660400010B3440000859C1000042CF0800021680800010B442000085A41000042D30828A240000D49100110000390B40000E4310000296C40000F3CD00003CF440000B55500002D5640000C4F50000313E40000C4FD00003140400010379000040DF400010381000040E1400011319000044C74181";
				 B = fromString(msg);
				expected = false; 
				 actual= ThreadListenerATC_IXL::ConfrontaArrayByte(A, B);
				Assert::AreEqual(expected, actual);


			}
	};
}
namespace SchedulerATSTest {

}
